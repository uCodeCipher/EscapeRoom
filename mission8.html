<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mission 8</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main>
    <h1>Mission 8 ‚Äì Final Escape: The Last Lock</h1>
    <p>You're moments away from shutting down Spectra AI. To complete your mission, enter your agent name and the final password. Only one button will save your data‚Ä¶</p>

    <form id="escapeForm">
      <label for="agent">Agent Name:</label><br>
      <input type="text" id="agent" name="agent" required /><br><br>
      <label for="key">Final Password:</label><br>
      <input type="text" id="key" name="key" required /><br><br>
      <button id="shutdown" type="button" disabled>SHUTDOWN FIREWALL</button>
      <button id="exit" type="button" disabled>LOCK SYSTEM</button>
    </form>

    <p id="result"></p>
  </main>

  <script>
    history.pushState(null, '', location.href);
    window.addEventListener('popstate', () => history.go(1));

    const shutdown = document.getElementById('shutdown');
    const exit = document.getElementById('exit');
    const result = document.getElementById('result');
    const passInput = document.getElementById('key');
    const agentInput = document.getElementById('agent');
    const missionDoneKey = 'mission8Completed';

    function getScore() {
      return Number(localStorage.getItem('spectraScore') || 0);
    }

    const code = [113, 102, 122, 120, 109, 37, 119, 90, 100, 119, 117, 102, 117];
    const correctKey = code.map(c => String.fromCharCode(c - 5)).join('').trim();

    if (localStorage.getItem(missionDoneKey) === 'true') {
      shutdown.disabled = true;
      exit.disabled = true;
      result.innerHTML = `‚úÖ Mission already completed.<br>Your data is safe.<br>Final Score: ${getScore()}<br><a href='index.html'>Play again</a>`;
    }

    passInput.addEventListener('input', () => {
      const userKey = passInput.value.trim().toLowerCase();
      if (userKey === correctKey) {
        shutdown.disabled = false;
        exit.disabled = false;
      } else {
        shutdown.disabled = true;
        exit.disabled = true;
      }
    });

    shutdown.addEventListener('click', function () {
      const agent = agentInput.value.trim();
      if (!agent) {
        result.textContent = "Please enter your agent name.";
        return;
      }
      localStorage.setItem(missionDoneKey, 'true');
      shutdown.disabled = true;
      exit.disabled = true;
      result.innerHTML = `<b>üõ°Ô∏è Mission Complete!</b><br>Congratulations, Agent ${agent}!<br>Your data is safe and Spectra AI is offline.<br><br><strong>Final Score: ${getScore()}</strong><br><br><a href='index.html'>Play again</a>`;
    });

    exit.addEventListener('click', function () {
      result.textContent = "‚ùå Spectra AI reactivated. Your data has been leaked to the Dark Web. Try again!";
    });
  </script>
</body>
</html>
