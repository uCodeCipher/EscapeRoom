<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mission 7</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main>
    <h1>Mission 7 – The Cipher Chain</h1>
    <p>To break Spectra's last lock, decode this encrypted string step-by-step and find the final password:</p>

    <div class="cipher">
      <p><strong>Encrypted String:</strong></p>
      <code>ZnhxenIgZXhhdG9lcw==</code>
    </div>

    <ol>
      <li>Decode the string using Base64 and ChatGPT.</li>
      <li>Reverse the decoded result (read it backwards).</li>
      <li>Apply a Caesar cipher with shift -5.</li>
      <li>Enter the final answer (two words, no capitals) below.</li>
    </ol>

    <form id="cipherForm">
      <label for="cipher">Final answer:</label><br>
      <input type="text" id="cipher" name="cipher" required />
      <button type="submit">Submit</button>
    </form>

    <p id="result"></p>
  </main>

  <script>
    history.pushState(null, '', location.href);
    window.addEventListener('popstate', () => history.go(1));

    function addPoint() {
      const s = Number(localStorage.getItem('spectraScore') || 0);
      localStorage.setItem('spectraScore', s + 1);
    }
    function getScore() {
      return Number(localStorage.getItem('spectraScore') || 0);
    }

    const encryptedCode = 'qdvjdymtbx fqlr';
    const correctAnswer = encryptedCode.split('').map(c => {
      return c === ' ' ? ' ' : String.fromCharCode(c.charCodeAt(0) + 5);
    }).join('').trim();

    const missionKey = 'mission7Solved';

    document.getElementById('cipherForm').addEventListener('submit', function(event) {
      event.preventDefault();
      const cipherInput = document.getElementById("cipher").value.trim().toLowerCase();
      const result = document.getElementById("result");
      const submitButton = document.querySelector('#cipherForm button');

      if (cipherInput === correctAnswer) {
        if (!localStorage.getItem(missionKey)) {
          addPoint();
          localStorage.setItem(missionKey, 'true');
        }
        result.innerHTML = `✅ Well done, Agent! Cipher chain broken. Current score: ${getScore()}<br><a href='mission8.html'>Continue to Mission 8</a>`;
        submitButton.disabled = true;
      } else {
        result.textContent = "❌ Incorrect. Follow all steps carefully and try again.";
      }
    });
  </script>
</body>
</html>
